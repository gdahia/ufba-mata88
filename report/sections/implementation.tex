\documentclass[../main.tex]{subfiles}
 
\begin{document}

\subsection{Linguagem Java}

O sistema foi implementado em linguagem Java, pois esta era, dentre as analisadas, a única sobre a qual todos os integrantes do grupo tinham domínio prévio suficiente, e que também possui integração e suporte nativo a ferramentas dedicadas a construção de sistemas distribuídos.

Dentre as ferramentas nativas de Java, a mais importante para o projeto foi Java RMI, pois permitiu que o sistema fosse implementado sem que fosse necessário se preocupar com gerenciamento de memória dentre os processos e, excetuando a inicialização requerida pelo sistema, a declaração de heranças e implementações relativas ao comportamento remoto das classes e o tratamento de exceções, as chamadas pudessem ser feitas como seriam localmente.
A importância de Java RMI é tal que dois processos que se comunicam diretamente só o fazem através de invocações remotas de métodos.

Além de Java RMI, a simplicidade para o tratamento de ações concorrentes em Java, também uma funcionalidade nativa da linguagem, tornou a implementação do trabalho muito mais fácil do que seria em alguma outra linguagem não tão apta a tarefa.
Já em estágio de desenvolvimento avançado do projeto, contudo, foi descoberto que os mecanismos de Java utilizados nesse trabalho para o tratamento de concorrência (o uso da classe \textit{Vector} ao invés da mais comumente utilizada \textit{ArrayList}, por exemplo) são pouco recomendados pela comunidade por falhas e que é mais apropriado utilizar novos métodos (como métodos \textit{synchronized} e a classe \textit{CopyOnWriteArrayList}).
Entretanto, os testes não conseguiram detectar problemas na implementação e, por isso, esse foi considerado um problema menor.

\subsection{Conexão entre clientes e servidor}

Um servidor para o sistema de troca de mensagens desta implementação deve implementar a interface remota \textit{Server}.
A única implementação fornecida é a classe \textit{ServerImpl}, a principal classe do lado do servidor da aplicação.
É através da obtenção de uma referência a um objeto remoto que implementa a interface \textit{Server} (na prática, uma instância de \textit{ServerImpl}) que se dá a comunicação entre clientes e servidor.
A aplicação do servidor, implementada na classe \textit{ServerApp}, instancia um objeto da classe \textit{ServerImpl}, o exporta e faz o \textit{bind} no registro.
A invocação da aplicação do servidor deve fornecer o endereço IP (com o comando \textit{java ServerApp [endereço IP]}) ao qual clientes deverão se conectar; caso contrário, é assumido que se trata de \textit{localhost}.

A aplicação do cliente, implementada na classe \textit{ClientApp}, é responsável por obter a referência ao objeto remoto que implementa o servidor, dado o endereço IP como argumento da invocação, e instanciar a classe \textit{Client}, responsável pela interação com o usuário, com a instância obtida como argumento.

\subsection{Interação com o usuário}

A interação com o usuário se dá através de um menu textual impresso na linha de comando de um terminal.
Não há interface gráfica.
Os comandos podem ser de dois tipos: ou correspondem a numeração especificada em algum menu ou a comandos similares aos utilizados em editores de texto modais, como \textit{vi}.

Os menus são implementados nas classes de sufixo \textit{Menu} e na classe \textit{Client}.
Existe interação mínima com o usuário também nas classes com sufixo \textit{Handler}.

\subsection{Cadastro de usuários}

Para se cadastrar no sistema, um novo usuário deve selecionar a opção \textit{Sign up} no menu principal.
Isso ocasiona a instanciação de um objeto da classe \textit{SessionHandler}, com argumento a referência ao servidor, cujo construtor é responsável por obter o nome que o usuário deseja utilizar no sistema e suas credenciais.
Em seguida, a invocação do método \textit{signUp} da classe \textit{SessionHandler} faz com que o nome de usuário escolhido e as credenciais sejam enviadas ao servidor através de uma invocação remota do método \textit{addUser}.
Este método verifica a disponibilidade do nome de usuário requisitado -- nomes de usuário são identificadores únicos para usuários e, portanto, não podem se repetir no servidor -- e, caso esteja livre, salva as credenciais do usuário associando-as a seu nome.
O usuário é informado com uma mensagem, na saída padrão, do sucesso ou não de sua requisição.

% utilizamos comunicacao direta entre cliente e servidor para implementar comunicacao indireta entre clientes (publish-subscribe nos grupos?)

\subsection{Login}

Para efetuar o login no sistem, o usuário deve selecionar a opção \textit{Sign in} no menu principal.
Feito isso o sistema irá pedir que o usuário digite seu \textit{Username}. Feito isso o sistema irá verificar a autenticidade das credenciais e identidade do usuário. Caso o se comprove a autenticidade, o usuário será recebido com uma mensagem de boas vindas e será redirecionado para o menu de sessão. Caso o usuário não seja quem ele diz ser, ele será notificado com uma mensagem de erro.

\subsection{New Chat}

Para criar novas conversas, o usuário deve selecionar a opção \textit{New Chat} no menu de sessão.
Uma vez selecionada esta opção, a sessão irá mandar uma requisição para o servidor, que caso suceda, irá instanciar um objeto da classe \textit{ChatImpl} e adicionar essa instância ao vetor de chats da sessão que fez a requisição. Caso contrário, será exibida uma mensagem de erro.

\subsection{Delete Account}

O usuário pode a qualquer momento deletar sua própria conta. Para fazer isso ele deve selecionar a opção \textit{Delete account} no menu de sessão. Uma vez feito isso, será exibida uma pergunta para garantir que o usuário realmente deseja deletar sua conta, já que isso implicaria sair de todas as conversas que o usuário participa e é irreversível. Caso a primeira letra digitada pelo usuário seja `y' a sua conta será deletada permanentemente. Caso contrário o usuário será redirecionado para o menu de sessão novamente.

Uma vez que o usuário seleciona a deleção de sua conta e confirma, a sessão irá chamar o método \textit{delete} que irá chamar o método \textir{removeUser} na instância do servidor que está sendo usada por aquele usuário e que recebe como argumento o nome de usuário. O servidor irá então remover a sessão e a credencial do usuário de suas respectivas \textit{Hashtable}s e ao retornar, a função delete irá remover o usuário de todas as conversas das quais ele participava. Feito isso o usuário irá receber uma mensagem garantindo que sua conta foi deletada, e será redirecionado para o menu principal da aplicação.

\subsection{Refresh Menu}

O usuário pode ser adicionado por outros usuários a novas conversas, porém, não foi implementada nenhuma funcionalidade que notificasse o usuário sobre adições em novas conversas. Por isso foi colocada uma opção no menu de sessão que possibilita ao usuário atualizar a sua lista de chats, ou seja, caso ele tenha sido adicionado em alguma conversa por outro usuário, esta não estará visível ao usuário até que ele selecione a opção \textit{Refresh menu} ou seja redirecionado ao menu de sessão por alguma outra opção. Quando o usuário seleciona está opção, será exibida uma mensagem dizendo que estas são as conversas que ele participa até agora, e o usuário será redirecionado novamente para o menu de sessão, porém, caso o usuário tenha sido adicionado a alguma conversa, esta agora estará visível, uma vez que a cada vez que o usuário é redirecionado ao menu de sessão, a lista de chats é atualizada.
\end{document}

